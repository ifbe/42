<html>
<head>
<script type="text/javascript">
function say(data)
{
	var debug=document.getElementById("debug");
	debug.textContent=debug.textContent+data+"\n";
	debug.scrollTop=debug.scrollHeight;
}

var ws=new WebSocket("ws://127.0.0.1:2222");
ws.binaryType = 'arraybuffer';
function send(data)
{
	say(data);
	if(ws.readyState == WebSocket.OPEN)
	{
		ws.send(data);
	}
}
function sendbin(data)
{
	//var bin = new Uint8Array(1024*1024*3);
	//for (var i = 0; i < 1024*1024; i+=3) {
		//do something
	//}
	//ws.send(bin.buffer);
}
function sendblob(data)
{
	//var file = document.querySelector('input[type="file"]').files[0];
	//ws.send(file);
}
ws.onmessage=function(event)
{
	if(typeof event.data === "string")
	{
		say("string "+event.data.length);
		document.getElementById('haha').innerHTML=event.data;
	}
	else //if(event.data instanceof ArrayBuffer)
	{
		say("binary "+event.data.byteLength);
	}
};
ws.onopen=function(event)
{
	say("welcome victim");
};
ws.onclose=function(event)
{
	say("connection closed");
	document.getElementById('haha').innerHTML="connection closed";
};
ws.onerror=function(event)
{
	say("something wrong");
	document.getElementById('haha').innerHTML="something wrong";
};

var oldw=0;
var oldh=0;
window.onresize=function(){  
	var w = window.innerWidth
	|| document.documentElement.clientWidth
	|| document.body.clientWidth;

	var h = window.innerHeight
	|| document.documentElement.clientHeight
	|| document.body.clientHeight;

	if((w!=oldw)&&(h!=oldh))
	{
		send("size "+w+","+h);

		oldw=w;
		oldh=h;
	}
}
window.onkeydown=function(ev){
	var k=ev.keyCode;
	if((k==8)||(k==9))
	{
		ev.preventDefault();
		send("char "+k);
	}
	else if(k==13||k==32||(k>=48&&k<=57))
	{
		send("char "+k);
	}
	else if(k>=65&&k<=90)
	{
		k=k+32;
		send("char "+k);
	}
	else
	{
		send("kbd "+k);
	}
}

function touch_start(theone,event)
{
	var a = document.getElementById("haha");
	var touch0 = event.touches[0];
	var x = touch0.clientX - a.offsetLeft;
	var y = touch0.clientY - a.offsetTop;
	say("touchatart "+x+" "+y);
}
function touch_move(theone,event)
{
	var a = document.getElementById("haha");
	var touch0 = event.touches[0];
	var x = touch0.clientX - a.offsetLeft;
	var y = touch0.clientY - a.offsetTop;
	say("touchmove "+x+" "+y);
}
function touch_end(theone,event)
{
	var a = document.getElementById("haha");
	var touch0 = event.touches[0];
	var x = touch0.clientX - a.offsetLeft;
	var y = touch0.clientY - a.offsetTop;
	say("touchend "+x+" "+y);
}

var lastmousex=-99;
var lastmousey=-99;
function mouse_start(theone,event)
{
	var a = document.getElementById("haha");
	var x = event.clientX - a.offsetLeft;
	var y = event.clientY - a.offsetTop;
	say("mousestart "+x+" "+y);
}
function mouse_move(theone,event)
{
	var a = document.getElementById("haha");
	var x = event.clientX - a.offsetLeft;
	var y = event.clientY - a.offsetTop;
	if((x==lastmousex)&&(y==lastmousey))return;

	lastmousex=x;
	lastmousey=y;
	say("mousemove "+x+" "+y);
}
function mouse_end(theone,event)
{
	var a = document.getElementById("haha");
	var x = event.clientX - a.offsetLeft;
	var y = event.clientY - a.offsetTop;
	say("mouseend "+x+" "+y);
}
function mouse_enter(theone,event)
{
	document.getElementById("haha").style.opacity=0.66;
}
function mouse_leave(theone,event)
{
	document.getElementById("haha").style.opacity=0.33;
}

</script>
</head>

<body style="background:black;margin:0;padding:0;overflow:hidden;">

<pre style="white-space:pre-wrap;white-space:-moz-pre-wrap;white-space:-pre-wrap;white-space:-o-pre-wrap;word-wrap:break-word;">
<code id="debug" style="position:absolute;width:100%;height:100%;background:#444;color:#fff;overflow-y:scroll;">
</code>
</pre>

<div id="haha" style="position:absolute;left:4%;top:4%;width:90%;height:90%;background:#444444;color:#fff;opacity:0.9;border-left:4px solid #473623;border-top:4px solid #456789;border-right:4px solid #012345;border-bottom:4px solid #222222;" onmousedown="mouse_start(this,event)" onmousemove="mouse_move(this,event)" onmouseup="mouse_end(this,event)" onmouseenter="mouse_enter(this,event)" onmouseleave="mouse_leave(this,event)" ontouchstart="touch_start(this,event)" ontouchend="touch_end(this,event)" ontouchmove="touch_move(this,event)">
</div>

</body>
</html>
